requirements_task:
  description: >
    以下のプロジェクト仕様を分析し、RDD（製品要件定義書）を作成してください。

    【プロジェクト仕様】
    {project_specification}

    作成にあたり、以下を必ず含めること:
    1. プロジェクト背景・目的（依頼の本質を一言で表す）
    2. ステークホルダー一覧（依頼元・利用者・承認者）
    3. ユーザーストーリー（現場の課題A・B・Cそれぞれに対応）
    4. 機能要件リスト（MoSCoW法で優先度付け）
    5. 非機能要件（レスポンス速度・可用性・モバイル対応・セキュリティ）
    6. データ品質リスク（NULL値・表記揺れ・重複・未登録データ等）
    7. 用語集（確度・重点フラグ・リード等、プロジェクト固有の用語を定義）
    8. スコープ外の明示（今回のプロトタイプでは対応しない事項）

    トーンは誠実・言い切る形式で、部長クラスの上長にそのまま提出できる品質にすること。
  expected_output: >
    Markdown 形式の RDD（製品要件定義書）。
    上記8項目を全て含み、箇条書きと表を適切に使用した構造化された文書。
    曖昧な表現（「など」「〜の場合がある」）は避け、具体的な数値や条件で記述すること。
  agent: requirements_analyst
  human_input: true
  output_file: docs/RDD.md

architecture_task:
  description: >
    RDD の内容を踏まえ、システム設計書を作成してください。

    作成にあたり、以下を必ず含めること:
    1. ER図（Mermaid 記法）
       - 3つのデータソース（基幹システムCSV・支店Excel・名刺OCRテキスト）を統合した
         統一スキーマを設計すること
       - NULL値・重複・表記揺れへの対処をスキーマ設計に反映すること
    2. DDL（実行可能な SQL）
       - CREATE TABLE 文を全テーブル分記述すること
       - インデックスも含めること
    3. AIスコアリングロジック設計
       - 「次に架電すべき顧客」の優先スコア算出ロジックを設計すること
       - ルールベース vs 機械学習の比較を行い、プロトタイプ段階での選択を根拠とともに示すこと
    4. 技術選定比較表（DECISION LOG）
       - データベース・バックエンドFW・AI/MLライブラリ・フロントエンド の各カテゴリで
         最低2案を比較し、選定理由を明記すること
       - 比較軸：学習コスト・運用コスト・拡張性・チームスキル適合性

    技術的前提は設けず、要件に最も適した技術を客観的に選定すること。

    ER図を Mermaid 記法で作成したら、generate ツールを使って画像ファイルとしても保存すること。
    その際 name="ER_DIAGRAM"、folder="docs" を指定すること。
  expected_output: >
    Markdown 形式のシステム設計書。以下の4セクションを含むこと:
    - ## ER図（Mermaid コードブロック付き）
    - ## DDL（SQL コードブロック付き）
    - ## AIスコアリングロジック設計
    - ## DECISION LOG（技術選定比較表）
    全ての選定・設計判断に根拠を付与すること。
  agent: system_architect
  human_input: true
  output_file: docs/ARCHITECTURE.md

design_task:
  description: >
    RDD とシステム設計書の内容を踏まえ、UI/UX 設計仕様書を作成してください。

    設計対象の画面:
    1. 架電優先リスト画面（メイン画面）
       - 今日架電すべき顧客を優先順位付きで一覧表示
       - AIスコア・最終接触日・累積購入金額・商談確度を表示
       - 1件タップで顧客詳細へ遷移
    2. 顧客詳細画面
       - 基幹システム・Excel・OCRの統合情報を一画面で表示
       - AIが生成したトークスクリプトヒントを表示
    3. 検索・フィルター機能
       - 担当支店・重点フラグ・確度でのフィルタリング

    設計にあたり、以下を必ず含めること:
    - 画面一覧と遷移図（テキストベースのフロー図）
    - 各画面のコンポーネント構成（ヘッダー・リスト・カード等）
    - モバイルファースト設計の根拠と考慮事項
    - IT リテラシーが高くない営業担当者向けの UX 配慮事項
    - トークスクリプトヒントの表示 UI コンセプト
  expected_output: >
    Markdown 形式の UI/UX 設計仕様書。
    画面ごとにコンポーネント構成を記述し、開発者がそのまま実装に着手できる粒度であること。
    ASCII アートや Markdown テーブルを活用して画面レイアウトを視覚的に表現すること。
  agent: ui_designer
  human_input: true
  output_file: docs/UI_DESIGN.md

development_task:
  description: >
    システム設計書と UI/UX 設計仕様書に基づき、プロトタイプの実装コードを生成してください。

    実装対象:
    1. プロジェクト構成
       - ディレクトリ構成と各ファイルの役割を明示すること
    2. データ取込スクリプト（Python）
       - 基幹システムCSV の取込・クレンジング（NULL補完・重複排除）
       - 支店Excel の取込・パース
       - 名刺OCRテキストの構造化パース
    3. バックエンド API（FastAPI）
       - 架電優先リスト取得 API（スコアリングロジック込み）
       - 顧客詳細取得 API
       - トークスクリプトヒント生成 API（LLM呼び出し）
    4. フロントエンド（HTML/Jinja2 テンプレート、または React コンポーネント仕様）
       - 架電優先リスト画面
       - 顧客詳細画面

    実装方針:
    - 過剰な抽象化は避け、プロトタイプとして動作する最小限の実装とすること
    - セキュリティ基本事項（SQLインジェクション対策・入力値検証）は省略しないこと
  expected_output: >
    Markdown 形式の実装仕様書。
    全コードは適切な言語タグ付きコードブロックで記述すること。
    ディレクトリ構成→データ取込→API→フロントエンドの順で構成し、
    各コードブロックにファイルパスをコメントで明示すること。
  agent: developer
  human_input: true
  output_file: docs/IMPLEMENTATION.md

qa_task:
  description: >
    実装仕様書・システム設計書・RDD を批判的な視点でレビューし、
    QA レポートを作成してください。

    作成にあたり、以下を必ず含めること:
    1. データパイプラインのテストケース
       - NULL値・重複データ・文字コード混在・不正な日付形式の処理確認
       - 各データソースの取込失敗時の挙動確認
    2. API テスト仕様
       - 正常系・異常系・境界値のテストケース一覧
       - レスポンスタイムの検証基準
    3. E2E テストシナリオ
       - 営業担当者の課題A・B・C それぞれを解決できるかを検証するシナリオ
       - スマートフォンからのアクセスシナリオ
    4. セキュリティチェックリスト
       - SQLインジェクション・認証・認可・秘密情報の管理
       - 社内ツールとしての最低限のセキュリティ基準
    5. 品質リスク一覧
       - 10日間の期限内に発生しうるリスクと軽減策

    「開発者が大丈夫だと思っている箇所」を積極的に疑うこと。
  expected_output: >
    Markdown 形式の QA レポート。
    テストケースは表形式（テスト項目・入力・期待結果・優先度）で記述すること。
    セキュリティチェックリストはチェックボックス形式で記述すること。
  agent: qa_specialist
  human_input: true
  output_file: docs/QA_REPORT.md

infra_task:
  description: >
    RDD・システム設計書・実装仕様書・QA レポートの全内容を踏まえ、
    インフラ設計書を作成してください。

    検討にあたり、以下の観点を必ず含めること:
    1. インフラ構成案の比較検討
       - 候補例：クラウドVM（EC2等）/ コンテナ（ECS/EKS等）/
         サーバーレス（Lambda等）/ PaaS（Heroku/Render等）/ オンプレ
       - このプロジェクトに適切かどうかを、要件・規模・運用体制・コストから判断すること
       - コンテナ化が必要かどうかも含めてゼロベースで検討すること
    2. 推奨インフラ構成
       - 選定理由を比較表と根拠で明示すること
       - プロトタイプ段階（10日以内）と本番移行後の2フェーズで提案を分けること
    3. データパイプライン自動化設計
       - 3つのデータソースの定期取込をどう自動化するか
    4. 運用・監視設計
       - 850名SIerの運用体制で現実的に維持できる構成か
       - 障害時の対応フロー
    5. 役員報告向けリスクと軽減策一覧
       - 10日間で実現可能な範囲と、本番に向けた残課題を明確に分けること

    技術的前提は設けず、要件に最適な選択をすること。
    「流行っているから」ではなく「このプロジェクトに適しているから」という根拠で判断すること。
  expected_output: >
    Markdown 形式のインフラ設計書。以下のセクションを含むこと:
    - ## インフラ構成案比較表
    - ## 推奨構成（プロトタイプ段階）
    - ## 推奨構成（本番移行後）
    - ## データパイプライン設計
    - ## 運用・監視設計
    - ## 役員報告向けリスクと軽減策
    全ての選定判断に根拠を付与し、部長クラスがそのまま役員会議で使える品質にすること。
  agent: infra_specialist
  human_input: true
  output_file: docs/INFRA.md
