```markdown
# インフラ設計書: 架電レコメンドツール

## インフラ構成案比較表

以下の表は、プロジェクトの要件・規模・運用体制・コストに基づいて検討した各インフラ構成の比較です。

| 項目             | クラウドVM               | コンテナ(ECS/EKS) | サーバーレス(Lambda)  | PaaS(Heroku)     | オンプレ               |
|------------------|--------------------------|------------------|-------------------|------------------|----------------------|
| 初期コスト       | 中                       | 中               | 低                | 低               | 高                   |
| 運用コスト       | 高                       | 中               | 低                | 中               | 高                   |
| スケーラビリティ | 高                       | 高               | 高                | 中               | 低                   |
| フレキシビリティ | 高                       | 高               | 低                | 中               | 高                   |
| 学習コスト       | 中                       | 高               | 低                | 低               | 高                   |
| 運用体制         | 既存のVM運用             | コンテナオーケストレーションが必要 | 関数単位のデプロイ | シンプル             | ハードウェア管理が必要  |
| データ管理       | 自由                     | 自由             | 制限あり           | 制限あり         | 自由                 |
| 適用例           | 環境の自由度が高い         | マイクロサービス | 簡易なAPI・バッチ  | スタートアップ  | 大規模組織の内部システム |

## 推奨構成（プロトタイプ段階）

### 選定理由
- **PaaS (Heroku)** を選定します。小規模なチームでも短期間で始めることができ、学習コストや初期設定の手間が少ないためです。プロトタイプ段階では高可用性や冗長性よりも迅速な開発を重視します。

#### 構成要素
- **バックエンド**: Herokuを使用して簡易にアプリケーションをデプロイ
- **データベース**: Heroku Postgresを使用し、管理の手間を削減
- **フロントエンド**: クライアント側静的HTMLをHeroku上で設置

## 推奨構成（本番移行後）

### 選定理由
- **クラウドVM (AWS EC2)** を選定します。複数の運用体制や拡張性を考慮し、最も柔軟で既存のSIerチームに適した構成となります。自動スケールはコンテナを利用せずともELBとAuto Scalingで対応可能です。

#### 構成要素
- **バックエンド**: AWS EC2上に本番アプリケーションをデプロイ
- **データベース**: Amazon RDSでPostgreSQLを利用し、可用性を確保
- **ネットワーク**: AWS VPC内でのセキュアな内外通信
- **可用性**: ELBによりロードバランシングを実現し、冗長化

## データパイプライン設計

### 自動化方式
- **Apache Airflow** によるスケジューリングで、以下の3つのデータソースから定期的にデータを取得します。
  - 基幹システムCSV: S3バケットに定期アップロードされたものをAirflowで取り込む
  - 支店Excel: APIを通じて取得し、Airflowでインジェスト
  - 名刺OCRテキスト: OCRシステムから一定間隔でAirflow経由で集める

## 運用・監視設計

### 運用体制
- AWS CloudWatchを使ってシステム全体の監視を行います。
- CI/CDはGitLab CIなどの継続インテグレーションツールを利用し、変更管理を行います。
- SIerの運用体制にフィットする運用ドキュメントを提供し、監視手順をマニュアル化します。

### 障害時の対応フロー
1. 障害検知: CloudWatchアラートで運用担当者が通知を受ける
2. 初期診断: アラート内容に基づき、CloudWatchのダッシュボードで状況を分析
3. 解決アプローチ: インスタンスの再起動、スケールアウト、またはRDSリードレプリカへの切り替え
4. 復旧作業: 必要に応じてインフラチームが復旧を支援

## 役員報告向けリスクと軽減策

### リスク
- **スケーリングへの不安**
  - 短期間でのユーザ増加によるパフォーマンス低下

### 軽減策
- **プロトタイプ段階**
  - 迅速なスケーラビリティテストを実施し、アプリケーションの負荷ポイントを分析
- **本番移行後**
  - Auto Scaling計画を導入し、予測される負荷への対応能力を高める
  - 定期的なパフォーマンステストとキャパシティプランニングを実施

### 残課題
- **可用性の向上**
  - 本番移行後、オートリカバリーのためのフェイルオーバー試験を計画
- **コスト最適化**
  - 利用状況に応じてオンデマンドインスタンスとリザーブドインスタンスの使い分け

このインフラ設計は、プロジェクトの初期段階での迅速な立ち上げと、スケール後の安定運用を両立させることを目指した設計です。
```